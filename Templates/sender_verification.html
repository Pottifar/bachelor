<div class="card shadow-sm p-3 mb-4" style="background-color: var(--card-color); border-color: var(--border-color);">
    <div class="card-body" style="color: var(--text-color);">

        <div class="d-flex align-items-center mb-2">
            <h3 class="card-title mb-0" style="color: var(--primary-color);">Summary</h3>
        </div>

        <!-- GENERAL SECTION -->
        <div class="table-container">
            <h3 class="table-header" style="background-color: var(--section-header-color); color: var(--text-color);">
                GENERAL
                <span class="tooltip-trigger ms-2" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true" data-bs-custom-class="custom-tooltip"
                    title="
                        <div style='max-width: 250px; padding: 8px; text-align: left; font-size: 14px;'>
                            <h4 style='margin-bottom: 8px; font-size: 16px;'>üîç Email Headers</h4>
                            <ul style='padding-left: 16px; margin-bottom: 8px;'>
                                <li><strong>üì© From:</strong> The sender's email address (can be spoofed).</li>
                                <li><strong>üîÑ Reply-To:</strong> Where responses will be sent, and should match sender.</li>
                            </ul>
                            <div style='border-top: 1px solid var(--border-color); padding-top: 6px; margin-top: 6px; font-size: 13px;'>
                                General info about the email.
                            </div>
                        </div>
                    ">
                    <i class="bi bi-info-circle" style="color: var(--accent-color); font-size: 1.5rem;"></i>
                </span>
            </h3>

            <table class="table table-striped align-middle w-100" style="border: 1px solid var(--table-border);">
                <tbody>

                    <!-- USERS -->
                    <tr style="background-color: var(--row-even-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">From User:</th>
                        <td style="color: var(--text-color);">{{ headers["From-User"] }}</td>
                    </tr>
                    <tr style="background-color: var(--row-even-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">To User:</th>
                        <td style="color: var(--text-color);">{{ headers["To-User"] }}</td>
                    </tr>

                    <!-- DOMAINS -->
                    <tr style="background-color: var(--row-even-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">From Domain:</th>
                        <td style="color: var(--text-color);">{{ headers["From-Domain"] }}</td>
                    </tr>
                    <tr style="background-color: var(--row-even-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">To Domain:</th>
                        <td style="color: var(--text-color);">{{ headers["To-Domain"] }}</td>
                    </tr>

                    <!-- LEVENSTEIN DISTANCE -->
                    <tr style="background-color: var(--row-even-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">Levenstein distance:</th>
                        <td style="color: var(--text-color);">{{ headers["Levenshtein-Distance"] }}</td>
                    </tr>

                    <tr style="background-color: var(--row-odd-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">Reply-To:</th>
                        <td style="color: var(--text-color);">{{ headers["Reply-To"] }}</td>
                    </tr>
                    
                </tbody>
            </table>
        </div>

        <!-- SPF AND DMARC SIDE BY SIDE-->
        <div class="row">
            <!-- SPF CHECK -->
            <div class="col-md-6">
                <div class="table-container">
                    <h3 class="table-header" style="background-color: var(--section-header-color); color: var(--text-color);">
                        SPF CHECK
                        <span class="tooltip-trigger ms-2" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true" 
                            data-bs-custom-class="custom-tooltip"
                            title="
                                <div style='max-width: 250px; padding: 8px; text-align: left; font-size: 14px;'>
                                    <h4 style='margin-bottom: 8px; font-size: 16px;'>üîç SPF Check</h4>
                                    <ul style='padding-left: 16px; margin-bottom: 8px;'>
                                        <li><strong>üåê SPF Domain Checked:</strong> The domain used to verify the sender's legitimacy.</li>
                                        <li><strong>‚úÖ SPF Result:</strong> Indicates whether the sender is allowed to send emails for this domain.</li>
                                        <li><strong>‚ÑπÔ∏è SPF Explanation:</strong> Provides more details on why the SPF check passed or failed.</li>
                                    </ul>
                                    <div style='border-top: 1px solid var(--border-color); padding-top: 6px; margin-top: 6px; font-size: 13px;'>
                                        <strong>Why it matters:</strong> An SPF check verifies that the sender is who they claim to be. A fail might indicate that the sender is spoofed.
                                    </div>
                                </div>
                            ">
                            <i class="bi bi-info-circle" style="color: var(--accent-color); font-size: 1.5rem;"></i>
                        </span>
                    </h3>
        
                    <table class="table table-striped align-middle w-100" style="border: 1px solid var(--table-border);">
                        <tbody>
                            <tr style="background-color: var(--row-even-color);">
                                <th scope="row" class="text-end" style="color: var(--text-color);">SPF Result:</th>
                                <td class="px-3">
                                    <span class="badge" style="color: 
                                        {% if headers['SPF-Result'] == 'PASS' %}var(--success-color)
                                        {% elif headers['SPF-Result'] == 'FAIL' %}var(--danger-color)
                                        {% elif headers['SPF-Result'] == 'NEUTRAL' %}var(--warning-color)
                                        {% else %}var(--text-color){% endif %}; font-weight: bold;">
                                        {{ headers["SPF-Result"] }}
                                    </span>

                                </td>
                            </tr>
                            <tr style="background-color: var(--row-odd-color);">
                                <th scope="row" class="text-end" style="color: var(--text-color);">SPF Explanation:</th>
                                <td class="px-3" style="color: var(--text-color);">{{ headers["SPF-Explanation"] }}</td>
                            </tr>
                            <tr style="background-color: var(--row-even-color);">
                                <th scope="row" class="text-end" style="color: var(--text-color);">SPF Domain:</th>
                                <td class="px-3" style="color: var(--text-color);">{{ headers["SPF-Domain"] }}</td>
                            </tr>
                            <tr style="background-color: var(--row-odd-color);">
                                <th scope="row" class="text-end" style="color: var(--text-color);">SPF IP:</th>
                                <td class="px-3" style="color: var(--text-color);">{{ headers["SPF-IP"] }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        
            <!-- DMARC CHECK -->
            <div class="col-md-6">
                <div class="table-container">
                    <h3 class="table-header" style="background-color: var(--section-header-color); color: var(--text-color);">
                        DMARC CHECK
                        <span class="tooltip-trigger ms-2" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true" 
                            data-bs-custom-class="custom-tooltip"
                            title="
                                <div style='max-width: 250px; padding: 8px; text-align: left; font-size: 14px;'>
                                    <h4 style='margin-bottom: 8px; font-size: 16px;'>üîç DMARC Check</h4>
                                    <ul style='padding-left: 16px; margin-bottom: 8px;'>
                                        <li><strong>‚úÖ DMARC Result:</strong> Indicates whether the email passed or failed DMARC validation based on SPF and DKIM checks.</li>
                                        <li><strong>üåê DMARC Policy:</strong> The policy set by the domain owner to specify how email from their domain should be treated (e.g., reject, quarantine, or none).</li>
                                    </ul>
                                    <div style='border-top: 1px solid var(--border-color); padding-top: 6px; margin-top: 6px; font-size: 13px;'>
                                        <strong>Why it matters:</strong> DMARC adds an extra layer of protection by allowing domain owners to enforce policies on unauthorized emails. A failed DMARC check helps to identify emails that are likely spoofed or phishing attempts.
                                    </div>
                                </div>
                            ">
                            <i class="bi bi-info-circle" style="color: var(--accent-color); font-size: 1.5rem;"></i>
                        </span>
                    </h3>
                    <table class="table table-striped align-middle w-100" style="border: 1px solid var(--table-border);">
                        <tbody>
                            <tr style="background-color: var(--row-odd-color);">
                                <th scope="row" class="text-end" style="color: var(--text-color);">DMARC Result:</th>
                                <td class="px-3">
                                    <span class="badge" style="background-color: 
                                        {% if headers['DMARC-Result'] == 'PASS' %}var(--success-color); color: white;
                                        {% elif headers['DMARC-Result'] == 'FAIL' %}var(--danger-color); color: white;
                                        {% else %}var(--text-color); color: black;{% endif %}
                                        font-size: 14px; padding: 6px 12px;">
                                        {{ headers["DMARC-Result"] }}
                                    </span>

                                </td>
                            </tr>
                            <tr style="background-color: var(--row-odd-color);">
                                <th scope="row" class="text-end" style="color: var(--text-color);">DMARC Policy:</th>
                                <td class="px-3" style="color: var(--text-color);">{{ headers["DMARC-Policy"] }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>


        <!-- LEVENSHTEIN DISTANCE TABLE -->
        <div class="table-container">
            <h3 class="table-header" style="background-color: var(--section-header-color); color: var(--text-color);">
                DOMAIN SIMILARITY CHECK
                <span class="tooltip-trigger ms-2" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-html="true" 
                    data-bs-custom-class="custom-tooltip"
                    title="
                        <div style='max-width: 250px; padding: 8px; text-align: left; font-size: 14px;'>
                            <h4 style='margin-bottom: 8px; font-size: 16px;'>üîç Levenshtein Distance</h4>
                            <ul style='padding-left: 16px; margin-bottom: 8px;'>
                                <li><strong>What it does:</strong> Measures how different the sender's and recipient's domains are.</li>
                                <li><strong>Levenshtein Distance: Minimum number of operations to turn one string, into another.</li>
                                <li><strong>Low Distance (‚ö†Ô∏è 0-3):</strong> Domains are almost identical. This may indicate typosquatting (e.g., `google.com` ‚Üí `googie.com`).</li>
                                <li><strong>High Distance (5+):</strong> The domains appear different, but visually similar ones may use Cyrillic, Arabic, or other non-Latin characters (e.g., `apple.com` ‚Üí `–∞pple.com`).</li>
                                <li><strong>Added text (<span style='color: var(--danger-color);'>+</span>):</strong> Extra letters in the sender domain.</li>
                                <li><strong>Removed text (<span style='color: var(--info-color);'>-</span>):</strong> Missing letters compared to the recipient domain.</li>
                                <li><strong>Character swaps:</strong> Attackers may replace Latin letters with lookalikes (e.g., `o` ‚Üí `–æ` in Cyrillic).</li>
                            </ul>
                            <div style='border-top: 1px solid var(--border-color); padding-top: 6px; margin-top: 6px; font-size: 13px;'>
                                Attackers often make subtle changes to domains to trick users. Be cautious when the distance is low or when the domains look the same but have a high distance.
                            </div>
                        </div>

                    ">
                    <i class="bi bi-info-circle" style="color: var(--accent-color); font-size: 1.5rem;"></i>
                </span>
            </h3>

            <table class="table table-striped align-middle w-100" style="border: 1px solid var(--table-border);">
                <tbody>
                    <tr style="background-color: var(--row-even-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">From Domain:</th>
                        <td style="color: var(--text-color);">
                            {{ headers["From-Domain"] if headers["From-Domain"] else "<span style='color: var(--warning-color);'>Unknown</span>" }}
                        </td>
                    </tr>
                    <tr style="background-color: var(--row-odd-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">To Domain:</th>
                        <td style="color: var(--text-color);">
                            {{ headers["To-Domain"] if headers["To-Domain"] else "<span style='color: var(--warning-color);'>Unknown</span>" }}
                        </td>
                    </tr>
                    <tr style="background-color: var(--row-even-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">Levenshtein Distance:</th>
                        <td style="color: var(--text-color);">
                            {% if headers["Levenshtein-Distance"] is not none %}
                                {{ headers["Levenshtein-Distance"] }}
                            {% else %}
                                <span style="color: var(--warning-color); font-weight: bold;">N/A</span>
                            {% endif %}
                        </td>
                    </tr>
                    <tr style="background-color: var(--row-odd-color);">
                        <th scope="row" class="text-end" style="color: var(--text-color);">Differences:</th>
                        <td style="color: var(--text-color); font-weight: bold;">
                            {% if headers["Domain-Differences"] and headers["Domain-Differences"] != "No major differences" %}
                                {{ headers["Domain-Differences"] | safe }}
                            {% else %}
                                <span style="color: var(--success-color); font-weight: bold;">No major differences detected</span>
                            {% endif %}
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>


    </div>
</div>
